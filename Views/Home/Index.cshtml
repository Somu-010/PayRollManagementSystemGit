@{
    ViewData["Title"] = "Dashboard";
}

<style>
    .stats-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
        gap: 20px;
        margin-bottom: 30px;
    }

    .stat-card {
        background: white;
        border-radius: 16px;
        padding: 24px;
        box-shadow: 0 2px 15px rgba(52, 152, 219, 0.08);
        transition: all 0.3s ease;
        position: relative;
        overflow: hidden;
    }

        .stat-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 4px;
            height: 100%;
            background: linear-gradient(135deg, #6dd5ed 0%, #2193b0 100%);
        }

        .stat-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 10px 30px rgba(52, 152, 219, 0.15);
        }

        .stat-card.clickable {
            cursor: pointer;
        }

    .stat-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 16px;
    }

    .stat-title {
        font-size: 14px;
        color: #5a6c7d;
        font-weight: 500;
    }

    .stat-icon {
        width: 48px;
        height: 48px;
        border-radius: 12px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 24px;
    }

        .stat-icon.blue {
            background: rgba(109, 213, 237, 0.15);
        }

        .stat-icon.green {
            background: rgba(52, 211, 153, 0.15);
        }

        .stat-icon.orange {
            background: rgba(251, 146, 60, 0.15);
        }

        .stat-icon.cyan {
            background: rgba(33, 147, 176, 0.15);
        }

        .stat-icon.purple {
            background: rgba(168, 85, 247, 0.15);
        }

        .stat-icon.pink {
            background: rgba(236, 72, 153, 0.15);
        }

    .stat-value {
        font-size: 32px;
        font-weight: 700;
        color: #2c3e50;
        margin-bottom: 8px;
    }

    .stat-change {
        font-size: 13px;
        color: #10b981;
        font-weight: 500;
    }

        .stat-change.negative {
            color: #ef4444;
        }

        .stat-change.neutral {
            color: #5a6c7d;
        }

    .content-grid {
        display: grid;
        grid-template-columns: repeat(2, 1fr);
        gap: 20px;
        margin-bottom: 30px;
    }

    .content-card {
        background: white;
        border-radius: 16px;
        padding: 24px;
        box-shadow: 0 2px 15px rgba(52, 152, 219, 0.08);
    }

    .card-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 20px;
        padding-bottom: 16px;
        border-bottom: 1px solid #e8f4f8;
    }

    .card-title {
        font-size: 18px;
        font-weight: 600;
        color: #2c3e50;
    }

    .view-all-link {
        font-size: 14px;
        color: #2193b0;
        text-decoration: none;
        font-weight: 500;
        transition: color 0.3s;
    }

        .view-all-link:hover {
            color: #6dd5ed;
        }

    .recent-item {
        padding: 16px 0;
        border-bottom: 1px solid #f8fafb;
        display: flex;
        justify-content: space-between;
        align-items: center;
    }

        .recent-item:last-child {
            border-bottom: none;
        }

    .item-info {
        display: flex;
        align-items: center;
        gap: 12px;
        flex: 1;
    }

    .item-avatar {
        width: 40px;
        height: 40px;
        border-radius: 50%;
        background: linear-gradient(135deg, #6dd5ed 0%, #2193b0 100%);
        display: flex;
        align-items: center;
        justify-content: center;
        color: white;
        font-weight: 600;
        font-size: 14px;
        flex-shrink: 0;
    }

    .dept-avatar {
        width: 40px;
        height: 40px;
        border-radius: 10px;
        background: linear-gradient(135deg, #6dd5ed 0%, #2193b0 100%);
        display: flex;
        align-items: center;
        justify-content: center;
        color: white;
        font-weight: 600;
        font-size: 14px;
        flex-shrink: 0;
    }

    .desig-avatar {
        width: 40px;
        height: 40px;
        border-radius: 10px;
        background: linear-gradient(135deg, #ec4899 0%, #8b5cf6 100%);
        display: flex;
        align-items: center;
        justify-content: center;
        color: white;
        font-weight: 600;
        font-size: 14px;
        flex-shrink: 0;
    }

    .shift-avatar {
        width: 40px;
        height: 40px;
        border-radius: 10px;
        background: linear-gradient(135deg, #fb923c 0%, #f59e0b 100%);
        display: flex;
        align-items: center;
        justify-content: center;
        color: white;
        font-weight: 600;
        font-size: 14px;
        flex-shrink: 0;
    }

    .item-details {
        flex: 1;
        min-width: 0;
    }

    .item-details h4 {
        font-size: 14px;
        font-weight: 600;
        color: #2c3e50;
        margin: 0 0 4px 0;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
    }

    .item-details p {
        font-size: 12px;
        color: #5a6c7d;
        margin: 0;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
    }

    .item-amount {
        font-size: 16px;
        font-weight: 600;
        color: #10b981;
        flex-shrink: 0;
        margin-left: 10px;
    }

    .item-count {
        font-size: 16px;
        font-weight: 600;
        color: #2193b0;
        flex-shrink: 0;
        margin-left: 10px;
    }

    .item-salary {
        font-size: 12px;
        color: #10b981;
        font-weight: 600;
        flex-shrink: 0;
        margin-left: 10px;
        text-align: right;
    }

    .badge {
        padding: 6px 12px;
        border-radius: 20px;
        font-size: 12px;
        font-weight: 600;
        display: inline-block;
    }

    .badge-present {
        background: rgba(16, 185, 129, 0.1);
        color: #10b981;
    }

    .badge-absent {
        background: rgba(239, 68, 68, 0.1);
        color: #ef4444;
    }

    .badge-late {
        background: rgba(251, 146, 60, 0.1);
        color: #fb923c;
    }

    .badge-leave {
        background: rgba(99, 102, 241, 0.1);
        color: #6366f1;
    }

    .badge-halfday {
        background: rgba(234, 179, 8, 0.1);
        color: #eab308;
    }

    .quick-actions-section {
        grid-column: 1 / -1;
    }

    .quick-actions {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
        gap: 12px;
    }

    .action-btn {
        padding: 16px;
        border: 2px solid #e8f4f8;
        border-radius: 12px;
        background: white;
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: 8px;
        cursor: pointer;
        transition: all 0.3s ease;
        text-decoration: none;
        color: #2c3e50;
    }

        .action-btn:hover {
            border-color: #6dd5ed;
            background: rgba(109, 213, 237, 0.05);
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(33, 147, 176, 0.15);
        }

    .action-icon {
        font-size: 28px;
    }

    .action-label {
        font-size: 13px;
        font-weight: 600;
    }

    .no-data {
        text-align: center;
        padding: 20px;
        color: #5a6c7d;
        font-size: 14px;
    }

    @@media (max-width: 968px) {
        .content-grid {
            grid-template-columns: 1fr;
        }

        .stats-grid {
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        }
    }
</style>

<div class="dashboard-container">
    <!-- Stats Cards -->
    <div class="stats-grid">
        <div class="stat-card clickable" onclick="window.location.href='@Url.Action("Index", "Employee")'">
            <div class="stat-header">
                <span class="stat-title">Total Employees</span>
                <div class="stat-icon blue">👥</div>
            </div>
            <div class="stat-value">@ViewBag.TotalEmployees</div>
            <div class="stat-change @(ViewBag.EmployeeGrowth >= 0 ? "" : "negative")">
                @(ViewBag.EmployeeGrowth >= 0 ? "↑" : "↓") @Math.Abs(ViewBag.EmployeeGrowth).ToString("F1")% from last month
            </div>
        </div>

        <div class="stat-card clickable" onclick="window.location.href='@Url.Action("Index", "Attendance")'">
            <div class="stat-header">
                <span class="stat-title">Today's Attendance</span>
                <div class="stat-icon green">✓</div>
            </div>
            <div class="stat-value">@ViewBag.PresentToday/@ViewBag.ActiveEmployees</div>
            <div class="stat-change @(ViewBag.AttendancePercentage >= 75 ? "" : ViewBag.AttendancePercentage >= 50 ? "neutral" : "negative")">
                @ViewBag.AttendancePercentage.ToString("F1")% attendance rate
            </div>
        </div>

        <div class="stat-card clickable" onclick="window.location.href='@Url.Action("Index", "Department")'">
            <div class="stat-header">
                <span class="stat-title">Total Departments</span>
                <div class="stat-icon purple">🏢</div>
            </div>
            <div class="stat-value">@ViewBag.TotalDepartments</div>
            <div class="stat-change neutral">@ViewBag.ActiveDepartments active departments</div>
        </div>

        <div class="stat-card clickable" onclick="window.location.href='@Url.Action("Index", "Designation")'">
            <div class="stat-header">
                <span class="stat-title">Total Designations</span>
                <div class="stat-icon pink">💼</div>
            </div>
            <div class="stat-value">@ViewBag.TotalDesignations</div>
            <div class="stat-change neutral">@ViewBag.ActiveDesignations active designations</div>
        </div>

        <div class="stat-card clickable" onclick="window.location.href='@Url.Action("Index", "Shift")'">
            <div class="stat-header">
                <span class="stat-title">Total Shifts</span>
                <div class="stat-icon orange">⏰</div>
            </div>
            <div class="stat-value">@ViewBag.TotalShifts</div>
            <div class="stat-change neutral">@ViewBag.ActiveShifts active shifts</div>
        </div>

        <div class="stat-card">
            <div class="stat-header">
                <span class="stat-title">Monthly Payroll</span>
                <div class="stat-icon green">💰</div>
            </div>
            <div class="stat-value">$@(ViewBag.MonthlyPayroll != null ? ((decimal)ViewBag.MonthlyPayroll).ToString("N0") : "0")</div>
            <div class="stat-change">@ViewBag.ActiveEmployees active employees</div>
        </div>

        <div class="stat-card clickable" onclick="window.location.href='@Url.Action("Index", "Attendance", new { status = "Late" })'">
            <div class="stat-header">
                <span class="stat-title">Late Arrivals Today</span>
                <div class="stat-icon orange">⏰</div>
            </div>
            <div class="stat-value">@ViewBag.LateToday</div>
            <div class="stat-change @(ViewBag.LateToday > 0 ? "negative" : "")">
                @if (ViewBag.LateToday > 0)
                {
                    <span>⚠️ @ViewBag.LateToday employees late</span>
                }
                else
                {
                    <span>✓ No late arrivals</span>
                }
            </div>
        </div>

        <div class="stat-card clickable" onclick="window.location.href='@Url.Action("Index", "Attendance", new { status = "OnLeave" })'">
            <div class="stat-header">
                <span class="stat-title">On Leave Today</span>
                <div class="stat-icon cyan">🏖️</div>
            </div>
            <div class="stat-value">@ViewBag.OnLeaveToday</div>
            <div class="stat-change">@ViewBag.AbsentToday absent employees</div>
        </div>
    </div>

    <!-- Content Grid -->
    <div class="content-grid">
        <!-- Recent Employees -->
        <div class="content-card">
            <div class="card-header">
                <h2 class="card-title">👥 Recent Employees</h2>
                <a asp-controller="Employee" asp-action="Index" class="view-all-link">View All →</a>
            </div>

            @if (ViewBag.RecentEmployees != null && ViewBag.RecentEmployees.Count > 0)
            {
                @foreach (var emp in ViewBag.RecentEmployees)
                {
                    string[] nameParts = emp.Name.Split(' ');
                    string initials = nameParts.Length > 1 
                        ? nameParts[0].Substring(0, 1) + nameParts[1].Substring(0, 1)
                        : emp.Name.Substring(0, Math.Min(2, emp.Name.Length));
                    <div class="recent-item">
                        <div class="item-info">
                            <div class="item-avatar">@initials.ToUpper()</div>
                            <div class="item-details">
                                <h4>@emp.Name</h4>
                                <p>@emp.EmployeeCode • @emp.DesignationName</p>
                            </div>
                        </div>
                        <span class="item-salary">$@emp.BasicSalary.ToString("N0")</span>
                    </div>
                }
            }
            else
            {
                <div class="no-data">
                    <p>No employees found. <a asp-controller="Employee" asp-action="Create">Add your first employee</a></p>
                </div>
            }
        </div>

        <!-- Recent Attendance -->
        <div class="content-card">
            <div class="card-header">
                <h2 class="card-title">📅 Recent Attendance</h2>
                <a asp-controller="Attendance" asp-action="Index" class="view-all-link">View All →</a>
            </div>

            @if (ViewBag.RecentAttendance != null && ViewBag.RecentAttendance.Count > 0)
            {
                @foreach (var att in ViewBag.RecentAttendance)
                {
                    string employeeName = att.EmployeeName ?? "Unknown";
                    string[] nameParts = employeeName.Split(' ');
                    string initials = nameParts.Length > 1 
                        ? nameParts[0].Substring(0, 1) + nameParts[1].Substring(0, 1)
                        : employeeName.Substring(0, Math.Min(2, employeeName.Length));
                    
                    string statusValue = att.Status.ToString();
                    string statusClass = statusValue == "Present" ? "badge-present" : 
                                        statusValue == "Absent" ? "badge-absent" : 
                                        statusValue == "Late" ? "badge-late" :
                                        statusValue == "OnLeave" ? "badge-leave" : "badge-halfday";
                    string statusText = statusValue == "Present" ? "✓ Present" : 
                                       statusValue == "Absent" ? "✕ Absent" : 
                                       statusValue == "Late" ? "⏰ Late" :
                                       statusValue == "OnLeave" ? "🏖️ Leave" : "⏱️ Half Day";
                    
                    decimal? totalHours = att.TotalHours as decimal?;
                    
                    <div class="recent-item">
                        <div class="item-info">
                            <div class="item-avatar">@initials.ToUpper()</div>
                            <div class="item-details">
                                <h4>@employeeName</h4>
                                <p>@att.Date.ToString("MMM dd, yyyy") • @att.CheckInTime.ToString(@"hh\:mm")</p>
                            </div>
                        </div>
                        <div style="display: flex; flex-direction: column; align-items: flex-end; gap: 4px;">
                            <span class="badge @statusClass">@statusText</span>
                            @if (totalHours.HasValue)
                            {
                                <span style="font-size: 12px; color: #2193b0; font-weight: 600;">@totalHours.Value.ToString("0.00") hrs</span>
                            }
                        </div>
                    </div>
                }
            }
            else
            {
                <div class="no-data">
                    <p>No attendance records found. <a asp-controller="Attendance" asp-action="Create">Mark attendance</a></p>
                </div>
            }
        </div>

        <!-- Top Departments by Employee Count -->
        <div class="content-card">
            <div class="card-header">
                <h2 class="card-title">🏢 Top Departments</h2>
                <a asp-controller="Department" asp-action="Index" class="view-all-link">View All →</a>
            </div>

            @if (ViewBag.TopDepartments != null && ViewBag.TopDepartments.Count > 0)
            {
                @foreach (var dept in ViewBag.TopDepartments)
                {
                    <div class="recent-item">
                        <div class="item-info">
                            <div class="dept-avatar">@dept.Name.Substring(0, Math.Min(2, dept.Name.Length)).ToUpper()</div>
                            <div class="item-details">
                                <h4>@dept.Name</h4>
                                <p>@dept.DepartmentCode • Department</p>
                            </div>
                        </div>
                        <span class="item-count">@dept.EmployeeCount <span style="font-size: 12px; color: #5a6c7d;">emp</span></span>
                    </div>
                }
            }
            else
            {
                <div class="no-data">
                    <p>No departments found. <a asp-controller="Department" asp-action="Create">Add your first department</a></p>
                </div>
            }
        </div>

        <!-- Top Designations by Employee Count -->
        <div class="content-card">
            <div class="card-header">
                <h2 class="card-title">💼 Top Designations</h2>
                <a asp-controller="Designation" asp-action="Index" class="view-all-link">View All →</a>
            </div>

            @if (ViewBag.TopDesignations != null && ViewBag.TopDesignations.Count > 0)
            {
                @foreach (var desig in ViewBag.TopDesignations)
                {
                    var minSalary = desig.MinimumSalary as decimal?;
                    var maxSalary = desig.MaximumSalary as decimal?;
                    <div class="recent-item">
                        <div class="item-info">
                            <div class="desig-avatar">@desig.Title.Substring(0, Math.Min(2, desig.Title.Length)).ToUpper()</div>
                            <div class="item-details">
                                <h4>@desig.Title</h4>
                                <p>@desig.DesignationCode • @desig.DepartmentName</p>
                            </div>
                        </div>
                        <div style="display: flex; flex-direction: column; align-items: flex-end; gap: 4px;">
                            <span class="item-count">@desig.EmployeeCount <span style="font-size: 12px; color: #5a6c7d;">emp</span></span>
                            @if (minSalary.HasValue && maxSalary.HasValue)
                            {
                                <span class="item-salary">$@minSalary.Value.ToString("N0")-$@maxSalary.Value.ToString("N0")</span>
                            }
                        </div>
                    </div>
                }
            }
            else
            {
                <div class="no-data">
                    <p>No designations found. <a asp-controller="Designation" asp-action="Create">Add your first designation</a></p>
                </div>
            }
        </div>

        <!-- Active Shifts -->
        <div class="content-card">
            <div class="card-header">
                <h2 class="card-title">⏰ Active Shifts</h2>
                <a asp-controller="Shift" asp-action="Index" class="view-all-link">View All →</a>
            </div>

            @if (ViewBag.TopShifts != null && ViewBag.TopShifts.Count > 0)
            {
                @foreach (var shift in ViewBag.TopShifts)
                {
                    string shiftInitials = shift.ShiftName.Substring(0, Math.Min(2, shift.ShiftName.Length));
                    <div class="recent-item">
                        <div class="item-info">
                            <div class="shift-avatar">@shiftInitials.ToUpper()</div>
                            <div class="item-details">
                                <h4>@shift.ShiftName @(shift.IsNightShift ? "🌙" : "☀️")</h4>
                                <p>@shift.ShiftCode • @shift.StartTime.ToString(@"hh\:mm") - @shift.EndTime.ToString(@"hh\:mm")</p>
                            </div>
                        </div>
                        <span class="item-count">@shift.AssignedEmployees <span style="font-size: 12px; color: #5a6c7d;">emp</span></span>
                    </div>
                }
            }
            else
            {
                <div class="no-data">
                    <p>No shifts found. <a asp-controller="Shift" asp-action="Create">Add your first shift</a></p>
                </div>
            }
        </div>

        <!-- Quick Actions -->
        <div class="content-card quick-actions-section">
            <div class="card-header">
                <h2 class="card-title">⚡ Quick Actions</h2>
            </div>

            <div class="quick-actions">
                <a asp-controller="Employee" asp-action="Create" class="action-btn">
                    <span class="action-icon">➕</span>
                    <span class="action-label">Add Employee</span>
                </a>

                <a asp-controller="Attendance" asp-action="Create" class="action-btn">
                    <span class="action-icon">📅</span>
                    <span class="action-label">Mark Attendance</span>
                </a>

                <a asp-controller="Department" asp-action="Create" class="action-btn">
                    <span class="action-icon">🏢</span>
                    <span class="action-label">Add Department</span>
                </a>

                <a asp-controller="Designation" asp-action="Create" class="action-btn">
                    <span class="action-icon">💼</span>
                    <span class="action-label">Add Designation</span>
                </a>

                <a asp-controller="Shift" asp-action="Create" class="action-btn">
                    <span class="action-icon">⏰</span>
                    <span class="action-label">Add Shift</span>
                </a>

                <a asp-controller="Attendance" asp-action="BulkMarkAttendance" class="action-btn">
                    <span class="action-icon">👥</span>
                    <span class="action-label">Bulk Attendance</span>
                </a>

                <a href="#" class="action-btn">
                    <span class="action-icon">💵</span>
                    <span class="action-label">Process Payroll</span>
                </a>

                <a asp-controller="Attendance" asp-action="MonthlyReport" class="action-btn">
                    <span class="action-icon">📋</span>
                    <span class="action-label">Monthly Report</span>
                </a>

                <a href="#" class="action-btn">
                    <span class="action-icon">✅</span>
                    <span class="action-label">Approve Leaves</span>
                </a>
            </div>
        </div>
    </div>
</div>