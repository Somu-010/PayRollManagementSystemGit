@model IEnumerable<PayRollManagementSystem.Controllers.UserViewModel>

@{
    ViewData["Title"] = "User Management";
}

<style>
    .page-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 30px;
    }

    .page-title {
        font-size: 28px;
        font-weight: 700;
        color: #2c3e50;
        display: flex;
        align-items: center;
        gap: 12px;
    }

    .page-title i {
        color: #2193b0;
    }

    .header-actions {
        display: flex;
        gap: 10px;
    }

    .btn-action {
        padding: 10px 20px;
        border-radius: 8px;
        text-decoration: none;
        font-weight: 500;
        transition: all 0.3s;
        border: none;
        cursor: pointer;
        display: flex;
        align-items: center;
        gap: 8px;
    }

    .btn-primary {
        background: linear-gradient(135deg, #6dd5ed 0%, #2193b0 100%);
        color: white;
    }

    .btn-secondary {
        background: #f8fafb;
        color: #2c3e50;
        border: 1px solid #e8e8e8;
    }

    .btn-secondary:hover {
        background: #e8f4f8;
    }

    .stats-row {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 20px;
        margin-bottom: 30px;
    }

    .stat-card {
        background: white;
        padding: 25px;
        border-radius: 12px;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
        text-align: center;
    }

    .stat-icon {
        font-size: 32px;
        margin-bottom: 10px;
        color: #2193b0;
    }

    .stat-value {
        font-size: 28px;
        font-weight: 700;
        color: #2c3e50;
    }

    .stat-label {
        font-size: 14px;
        color: #5a6c7d;
    }

    .users-table-container {
        background: white;
        border-radius: 12px;
        padding: 25px;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
    }

    .users-table {
        width: 100%;
        border-collapse: collapse;
    }

    .users-table thead {
        background: #f8fafb;
    }

    .users-table th {
        padding: 15px;
        text-align: left;
        font-size: 13px;
        font-weight: 600;
        color: #2c3e50;
        text-transform: uppercase;
        letter-spacing: 0.5px;
        border-bottom: 2px solid #e8e8e8;
    }

    .users-table td {
        padding: 15px;
        border-bottom: 1px solid #f1f3f5;
        font-size: 14px;
        color: #5a6c7d;
    }

    .users-table tbody tr:hover {
        background: #f8fafb;
    }

    .user-email {
        font-weight: 600;
        color: #2c3e50;
    }

    .role-badge {
        display: inline-block;
        padding: 4px 10px;
        border-radius: 20px;
        font-size: 11px;
        font-weight: 600;
        margin-right: 5px;
    }

    .role-admin { background: #fee2e2; color: #ef4444; }
    .role-hr { background: #dbeafe; color: #3b82f6; }
    .role-employee { background: #d1f4e0; color: #10b981; }
    .role-none { background: #f1f3f5; color: #5a6c7d; }

    .linked-employee {
        display: flex;
        align-items: center;
        gap: 8px;
    }

    .linked-badge {
        padding: 4px 10px;
        background: #d1f4e0;
        color: #10b981;
        border-radius: 6px;
        font-size: 12px;
        font-weight: 500;
        display: flex;
        align-items: center;
        gap: 5px;
    }

    .unlinked-badge {
        padding: 4px 10px;
        background: #fef3c7;
        color: #f59e0b;
        border-radius: 6px;
        font-size: 12px;
        font-weight: 500;
    }

    .btn-view {
        padding: 6px 12px;
        background: #e8f4f8;
        color: #2193b0;
        border: none;
        border-radius: 6px;
        font-size: 12px;
        text-decoration: none;
        transition: all 0.3s;
        display: inline-flex;
        align-items: center;
        gap: 5px;
    }

    .btn-view:hover {
        background: #2193b0;
        color: white;
    }

    .alert {
        padding: 15px 20px;
        border-radius: 10px;
        margin-bottom: 20px;
        display: flex;
        align-items: center;
        gap: 10px;
    }

    .alert-success {
        background: rgba(16, 185, 129, 0.1);
        color: #10b981;
        border: 1px solid rgba(16, 185, 129, 0.2);
    }

    .alert-error {
        background: rgba(239, 68, 68, 0.1);
        color: #ef4444;
        border: 1px solid rgba(239, 68, 68, 0.2);
    }

    .status-confirmed {
        color: #10b981;
        display: flex;
        align-items: center;
        gap: 5px;
    }

    .status-pending {
        color: #f59e0b;
        display: flex;
        align-items: center;
        gap: 5px;
    }
</style>

@if (TempData["Success"] != null)
{
    <div class="alert alert-success">
        <i class="fas fa-check-circle"></i>
        <span>@TempData["Success"]</span>
    </div>
}

@if (TempData["Error"] != null)
{
    <div class="alert alert-error">
        <i class="fas fa-exclamation-circle"></i>
        <span>@TempData["Error"]</span>
    </div>
}

<div class="page-header">
    <h1 class="page-title"><i class="fas fa-users-cog"></i> User Management</h1>
    <div class="header-actions">
        <a asp-action="UnlinkedEmployees" class="btn-action btn-secondary">
            <i class="fas fa-user-plus"></i> Unlinked Employees
        </a>
    </div>
</div>

<!-- Stats -->
<div class="stats-row">
    <div class="stat-card">
        <div class="stat-icon"><i class="fas fa-users"></i></div>
        <div class="stat-value">@Model.Count()</div>
        <div class="stat-label">Total Users</div>
    </div>
    <div class="stat-card">
        <div class="stat-icon"><i class="fas fa-user-shield"></i></div>
        <div class="stat-value">@Model.Count(u => u.Roles.Contains("Admin"))</div>
        <div class="stat-label">Admins</div>
    </div>
    <div class="stat-card">
        <div class="stat-icon"><i class="fas fa-user-tie"></i></div>
        <div class="stat-value">@Model.Count(u => u.Roles.Contains("HR"))</div>
        <div class="stat-label">HR Users</div>
    </div>
    <div class="stat-card">
        <div class="stat-icon"><i class="fas fa-user"></i></div>
        <div class="stat-value">@Model.Count(u => u.Roles.Contains("Employee"))</div>
        <div class="stat-label">Employees</div>
    </div>
    <div class="stat-card">
        <div class="stat-icon"><i class="fas fa-link"></i></div>
        <div class="stat-value">@Model.Count(u => u.LinkedEmployeeId.HasValue)</div>
        <div class="stat-label">Linked Accounts</div>
    </div>
</div>

<!-- Users Table -->
<div class="users-table-container">
    <table class="users-table">
        <thead>
            <tr>
                <th>Email</th>
                <th>Roles</th>
                <th>Linked Employee</th>
                <th>Status</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody>
            @foreach (var user in Model.OrderBy(u => u.Email))
            {
                <tr>
                    <td>
                        <span class="user-email">@user.Email</span>
                    </td>
                    <td>
                        @if (user.Roles.Any())
                        {
                            @foreach (var role in user.Roles)
                            {
                                var roleClass = role switch
                                {
                                    "Admin" => "role-admin",
                                    "HR" => "role-hr",
                                    "Employee" => "role-employee",
                                    _ => "role-none"
                                };
                                <span class="role-badge @roleClass">@role</span>
                            }
                        }
                        else
                        {
                            <span class="role-badge role-none">No Role</span>
                        }
                    </td>
                    <td>
                        @if (user.LinkedEmployeeId.HasValue)
                        {
                            <div class="linked-employee">
                                <span class="linked-badge"><i class="fas fa-link"></i> @user.LinkedEmployeeName</span>
                                <small style="color: #5a6c7d;">(@user.LinkedEmployeeCode)</small>
                            </div>
                        }
                        else
                        {
                            <span class="unlinked-badge">Not Linked</span>
                        }
                    </td>
                    <td>
                        @if (user.IsEmailConfirmed)
                        {
                            <span class="status-confirmed"><i class="fas fa-check-circle"></i> Confirmed</span>
                        }
                        else
                        {
                            <span class="status-pending"><i class="fas fa-clock"></i> Pending</span>
                        }
                    </td>
                    <td>
                        <a asp-action="Details" asp-route-id="@user.Id" class="btn-view">
                            <i class="fas fa-edit"></i> Manage
                        </a>
                    </td>
                </tr>
            }
        </tbody>
    </table>
</div>
